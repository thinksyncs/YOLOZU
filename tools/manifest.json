{
  "manifest_version": 1,
  "repo": {
    "name": "YOLOZU",
    "description": "Apache-2.0-only evaluation + tooling harness (CPU-first) for detection/pose workflows."
  },
  "contracts": {
    "predictions_json": {
      "summary": "YOLOZU predictions JSON (list of {image,detections} or {predictions:[...],meta:{...}}).",
      "schema": "docs/schemas/predictions.schema.json",
      "validator": "python3 tools/validate_predictions.py <path> [--strict]"
    },
    "metrics_report_json": {
      "summary": "Stable metrics report schema emitted by yolozu.metrics_report.build_report().",
      "schema": "docs/schemas/metrics_report.schema.json",
      "builder": "yolozu/metrics_report.py"
    },
    "coco_eval_report_json": {
      "summary": "Report payload emitted by tools/eval_coco.py (COCOeval or dry-run conversion).",
      "schema": "docs/schemas/coco_eval_report.schema.json",
      "producer": "python3 tools/eval_coco.py"
    },
    "eval_suite_report_json": {
      "summary": "Report payload emitted by tools/eval_suite.py (suite over prediction JSONs).",
      "schema": "docs/schemas/eval_suite_report.schema.json",
      "producer": "python3 tools/eval_suite.py"
    }
  },
  "tools": [
    {
      "id": "fetch_coco128",
      "entrypoint": "tools/fetch_coco128.sh",
      "runner": "bash",
      "summary": "Fetch tiny COCO subset (YOLO-format) into data/coco128 (official COCO hosting).",
      "tags": ["dataset"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "requires": { "network": true },
      "outputs": [
        { "name": "dataset_root", "kind": "dir", "description": "Created dataset root.", "default": "data/coco128" }
      ],
      "examples": [
        { "description": "Fetch dataset once for tests/smoke.", "command": "bash tools/fetch_coco128.sh" }
      ]
    },
    {
      "id": "prepare_coco_yolo",
      "entrypoint": "tools/prepare_coco_yolo.py",
      "runner": "python3",
      "summary": "Convert official COCO instances JSON into YOLO-format labels + (optional) copy images.",
      "tags": ["dataset", "coco"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "inputs": [
        { "name": "coco_root", "kind": "dir", "required": true, "flag": "--coco-root" },
        { "name": "out", "kind": "dir", "required": true, "flag": "--out" },
        { "name": "split", "kind": "string", "required": false, "flag": "--split", "default": "val2017" }
      ],
      "outputs": [
        { "name": "dataset_root", "kind": "dir", "description": "YOLO-format dataset root created at --out." },
        { "name": "dataset_descriptor", "kind": "file", "description": "Convenience dataset.json.", "default": "<out>/dataset.json" }
      ],
      "examples": [
        {
          "description": "Prepare val2017 labels without copying images.",
          "command": "python3 tools/prepare_coco_yolo.py --coco-root /path/to/coco --split val2017 --out data/coco-yolo"
        }
      ]
    },
    {
      "id": "build_manifest",
      "entrypoint": "tools/build_manifest.py",
      "runner": "python3",
      "summary": "Build a dataset manifest for data/coco128 (writes reports/manifest.json).",
      "tags": ["dataset"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "outputs": [
        { "name": "manifest_json", "kind": "file", "default": "reports/manifest.json" }
      ],
      "examples": [
        { "description": "Emit manifest JSON for coco128.", "command": "python3 tools/build_manifest.py" }
      ]
    },
    {
      "id": "export_predictions",
      "entrypoint": "tools/export_predictions.py",
      "runner": "python3",
      "summary": "Run an adapter to export YOLOZU predictions JSON (dummy or rtdetr_pose).",
      "tags": ["predictions", "adapter"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "produces": ["predictions_json"] },
      "inputs": [
        { "name": "adapter", "kind": "string", "required": false, "flag": "--adapter", "default": "dummy" },
        { "name": "dataset", "kind": "dir", "required": false, "flag": "--dataset", "default": "data/coco128" },
        { "name": "output", "kind": "file", "required": false, "flag": "--output", "default": "reports/predictions.json" }
      ],
      "outputs": [{ "name": "predictions_json", "kind": "file", "default": "reports/predictions.json" }],
      "examples": [
        {
          "description": "Export dummy predictions (schema smoke).",
          "command": "python3 tools/export_predictions.py --adapter dummy --dataset data/coco128 --wrap --output reports/predictions_dummy.json"
        }
      ],
      "docs": ["docs/real_model_interface.md"]
    },
    {
      "id": "validate_predictions",
      "entrypoint": "tools/validate_predictions.py",
      "runner": "python3",
      "summary": "Validate YOLOZU predictions JSON schema (permissive by default; strict optional).",
      "tags": ["predictions", "validation"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"] },
      "inputs": [{ "name": "predictions", "kind": "file", "required": true, "description": "Predictions JSON path." }],
      "outputs": [{ "name": "stdout", "kind": "stdout", "description": "OK/WARN lines." }],
      "examples": [
        { "description": "Strict schema validation.", "command": "python3 tools/validate_predictions.py reports/predictions.json --strict" }
      ]
    },
    {
      "id": "normalize_predictions",
      "entrypoint": "tools/normalize_predictions.py",
      "runner": "python3",
      "summary": "Normalize prediction class ids (category_idâ†”class_id) and optionally wrap with meta.",
      "tags": ["predictions", "transform"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"], "produces": ["predictions_json"] },
      "inputs": [
        { "name": "input", "kind": "file", "required": true, "flag": "--input" },
        { "name": "output", "kind": "file", "required": true, "flag": "--output" },
        { "name": "classes", "kind": "file", "required": false, "flag": "--classes" }
      ],
      "outputs": [{ "name": "predictions_json", "kind": "file", "description": "Normalized predictions JSON at --output." }],
      "examples": [
        {
          "description": "Remap COCO category_id -> contiguous class_id and wrap output.",
          "command": "python3 tools/normalize_predictions.py --input reports/predictions.json --output reports/predictions_norm.json --classes data/coco-yolo/labels/val2017/classes.json --wrap"
        }
      ]
    },
    {
      "id": "eval_coco",
      "entrypoint": "tools/eval_coco.py",
      "runner": "python3",
      "summary": "Evaluate predictions on a YOLO-format dataset using COCOeval (or dry-run convert/validate).",
      "tags": ["eval", "coco"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"], "produces": ["coco_eval_report_json"] },
      "inputs": [
        { "name": "dataset", "kind": "dir", "required": true, "flag": "--dataset" },
        { "name": "predictions", "kind": "file", "required": true, "flag": "--predictions" },
        { "name": "output", "kind": "file", "required": false, "flag": "--output", "default": "reports/coco_eval.json" }
      ],
      "outputs": [{ "name": "coco_eval_json", "kind": "file", "default": "reports/coco_eval.json" }],
      "examples": [
        {
          "description": "Dry-run conversion/validation without pycocotools.",
          "command": "python3 tools/eval_coco.py --dataset data/coco128 --predictions reports/predictions.json --dry-run --output reports/coco_eval_dry.json"
        }
      ]
    },
    {
      "id": "eval_suite",
      "entrypoint": "tools/eval_suite.py",
      "runner": "python3",
      "summary": "Evaluate a set of bucketed prediction JSONs (glob) and write a single suite report JSON.",
      "tags": ["eval", "suite", "yolo26"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"], "produces": ["eval_suite_report_json"] },
      "inputs": [
        { "name": "predictions_glob", "kind": "string", "required": true, "flag": "--predictions-glob" },
        { "name": "output", "kind": "file", "required": false, "flag": "--output", "default": "reports/eval_suite.json" }
      ],
      "outputs": [{ "name": "eval_suite_json", "kind": "file", "default": "reports/eval_suite.json" }],
      "examples": [
        {
          "description": "Evaluate all YOLO26 bucket predictions (no COCOeval) on coco128.",
          "command": "python3 tools/eval_suite.py --protocol yolo26 --dataset data/coco128 --predictions-glob 'reports/pred_yolo26*.json' --dry-run --output reports/eval_suite.json"
        }
      ],
      "docs": ["docs/yolo26_eval_protocol.md"]
    },
    {
      "id": "validate_map_targets",
      "entrypoint": "tools/validate_map_targets.py",
      "runner": "python3",
      "summary": "Validate the mAP target table file (baselines/yolo26_targets.json).",
      "tags": ["eval", "targets", "yolo26"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "inputs": [{ "name": "targets", "kind": "file", "required": false, "flag": "--targets", "default": "baselines/yolo26_targets.json" }],
      "outputs": [{ "name": "stdout", "kind": "stdout", "description": "OK or error details." }],
      "examples": [
        { "description": "Validate targets JSON.", "command": "python3 tools/validate_map_targets.py --targets baselines/yolo26_targets.json" }
      ]
    },
    {
      "id": "check_map_targets",
      "entrypoint": "tools/check_map_targets.py",
      "runner": "python3",
      "summary": "Compare eval_suite results against a target table and exit non-zero on failure.",
      "tags": ["eval", "targets", "gates", "yolo26"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "inputs": [
        { "name": "suite", "kind": "file", "required": false, "flag": "--suite", "default": "reports/eval_suite.json" },
        { "name": "targets", "kind": "file", "required": false, "flag": "--targets", "default": "baselines/yolo26_targets.json" }
      ],
      "outputs": [{ "name": "stdout", "kind": "stdout", "description": "JSON report with ok/failures." }],
      "examples": [
        { "description": "Gate a suite run vs targets.", "command": "python3 tools/check_map_targets.py --suite reports/eval_suite.json --targets baselines/yolo26_targets.json --key map50_95" }
      ]
    },
    {
      "id": "calibrate_scores",
      "entrypoint": "tools/calibrate_scores.py",
      "runner": "python3",
      "summary": "Temperature-scale detection scores to improve mAP proxy on a fixed subset (no NMS).",
      "tags": ["predictions", "calibration"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"], "produces": ["predictions_json", "metrics_report_json"] },
      "inputs": [
        { "name": "dataset", "kind": "dir", "required": true, "flag": "--dataset" },
        { "name": "predictions", "kind": "file", "required": true, "flag": "--predictions" }
      ],
      "outputs": [
        { "name": "predictions_calibrated", "kind": "file", "default": "reports/predictions_calibrated.json" },
        { "name": "report_json", "kind": "file", "default": "reports/calibration_report.json" }
      ],
      "examples": [
        {
          "description": "Calibrate scores on coco128 subset.",
          "command": "python3 tools/calibrate_scores.py --dataset data/coco128 --predictions reports/predictions.json --output reports/predictions_calibrated.json --output-report reports/calibration_report.json"
        }
      ],
      "docs": ["docs/score_calibration.md"]
    },
    {
      "id": "distill_predictions",
      "entrypoint": "tools/distill_predictions.py",
      "runner": "python3",
      "summary": "Blend teacher predictions into student predictions and write a distillation report.",
      "tags": ["predictions", "distillation"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"], "produces": ["predictions_json", "metrics_report_json"] },
      "inputs": [
        { "name": "student", "kind": "file", "required": true, "flag": "--student" },
        { "name": "teacher", "kind": "file", "required": true, "flag": "--teacher" }
      ],
      "outputs": [
        { "name": "predictions_distilled", "kind": "file", "default": "reports/predictions_distilled.json" },
        { "name": "report_json", "kind": "file", "default": "reports/distill_report.json" }
      ],
      "examples": [
        {
          "description": "Distill scores and evaluate proxy metrics on coco128.",
          "command": "python3 tools/distill_predictions.py --student reports/predictions_student.json --teacher reports/predictions_teacher.json --dataset data/coco128 --output reports/predictions_distilled.json --output-report reports/distill_report.json --add-missing"
        }
      ],
      "docs": ["docs/distillation.md"]
    },
    {
      "id": "tune_gate_weights",
      "entrypoint": "tools/tune_gate_weights.py",
      "runner": "python3",
      "summary": "Offline grid-search for inference-time score-fusion weights (CPU-only, simple mAP proxy).",
      "tags": ["predictions", "gates", "tuning"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"], "produces": ["metrics_report_json"] },
      "inputs": [
        { "name": "dataset", "kind": "dir", "required": true, "flag": "--dataset" },
        { "name": "predictions", "kind": "file", "required": true, "flag": "--predictions" }
      ],
      "outputs": [{ "name": "report_json", "kind": "file", "default": "reports/gate_tuning_report.json" }],
      "examples": [
        {
          "description": "Tune weights on a small coco128 slice.",
          "command": "python3 tools/tune_gate_weights.py --dataset data/coco128 --predictions reports/predictions.json --metric map50_95 --grid-det 1.0 --grid-tmp 0.0,0.5,1.0 --grid-unc 0.0,0.5,1.0 --output-report reports/gate_tuning_report.json"
        }
      ],
      "docs": ["docs/gate_weight_tuning.md"]
    },
    {
      "id": "check_predictions_parity",
      "entrypoint": "tools/check_predictions_parity.py",
      "runner": "python3",
      "summary": "Compare two prediction JSONs and report mismatches (IoU/tolerance-based).",
      "tags": ["predictions", "parity"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "consumes": ["predictions_json"] },
      "inputs": [
        { "name": "reference", "kind": "file", "required": true, "flag": "--reference" },
        { "name": "candidate", "kind": "file", "required": true, "flag": "--candidate" }
      ],
      "outputs": [{ "name": "stdout", "kind": "stdout", "description": "Mismatch report (JSON/text) and exit status." }],
      "examples": [
        {
          "description": "Parity check without reading image files (fixed image size).",
          "command": "python3 tools/check_predictions_parity.py --reference reports/pred_ref.json --candidate reports/pred_cand.json --image-size 640 --iou-thresh 0.99 --score-atol 1e-4 --bbox-atol 1e-4"
        }
      ],
      "docs": ["docs/onnx_export_parity.md"]
    },
    {
      "id": "export_predictions_onnxrt",
      "entrypoint": "tools/export_predictions_onnxrt.py",
      "runner": "python3",
      "summary": "Run ONNXRuntime inference and export YOLOZU predictions JSON (requires onnxruntime + numpy + opencv).",
      "tags": ["predictions", "onnxruntime"],
      "platform": {
        "cpu_ok": true,
        "gpu_required": false,
        "macos_ok": true,
        "linux_ok": true,
        "notes": "ONNXRuntime execution provider depends on your environment."
      },
      "requires": { "python_packages": ["onnxruntime", "numpy", "opencv-python"] },
      "contracts": { "produces": ["predictions_json"] },
      "examples": [
        {
          "description": "Export ONNXRuntime predictions (dry-run mode exists).",
          "command": "python3 tools/export_predictions_onnxrt.py --dataset data/coco128 --onnx /abs/path/model.onnx --combined-output output0 --combined-format xyxy_score_class --boxes-scale abs --min-score 0.0 --wrap --output reports/pred_onnxrt.json"
        }
      ],
      "docs": ["docs/onnx_export_parity.md"]
    },
    {
      "id": "build_trt_engine",
      "entrypoint": "tools/build_trt_engine.py",
      "runner": "python3",
      "summary": "Build a TensorRT engine from ONNX using trtexec and write a reproducible meta JSON.",
      "tags": ["tensorrt", "engine"],
      "platform": {
        "cpu_ok": true,
        "gpu_required": true,
        "macos_ok": false,
        "linux_ok": true,
        "notes": "Typically requires Linux + NVIDIA + TensorRT (trtexec)."
      },
      "requires": { "system": ["trtexec"] },
      "examples": [
        {
          "description": "Build FP16 engine (Linux/NVIDIA).",
          "command": "python3 tools/build_trt_engine.py --onnx yolo26n.onnx --engine engines/yolo26n_fp16.plan --precision fp16 --input-name images --min-shape 1x3x640x640 --opt-shape 1x3x640x640 --max-shape 1x3x640x640 --timing-cache engines/timing.cache --meta-output reports/trt_engine_yolo26n_fp16.json"
        }
      ],
      "docs": ["docs/tensorrt_pipeline.md"]
    },
    {
      "id": "export_predictions_trt",
      "entrypoint": "tools/export_predictions_trt.py",
      "runner": "python3",
      "summary": "Run TensorRT engine inference and export YOLOZU predictions JSON (requires tensorrt + CUDA bindings).",
      "tags": ["predictions", "tensorrt"],
      "platform": { "cpu_ok": false, "gpu_required": true, "macos_ok": false, "linux_ok": true },
      "requires": { "python_packages": ["tensorrt", "numpy", "opencv-python"], "system": ["CUDA bindings (pycuda or cuda-python)"] },
      "contracts": { "produces": ["predictions_json"] },
      "examples": [
        {
          "description": "Export TensorRT predictions (engine must exist).",
          "command": "python3 tools/export_predictions_trt.py --dataset /path/to/coco-yolo --engine engines/yolo26n_fp16.plan --combined-output output0 --boxes-scale abs --wrap --output reports/pred_trt_yolo26n.json"
        }
      ],
      "docs": ["docs/tensorrt_pipeline.md"]
    },
    {
      "id": "benchmark_latency",
      "entrypoint": "tools/benchmark_latency.py",
      "runner": "python3",
      "summary": "Latency/FPS benchmark harness producing stable JSON reports and optional JSONL history.",
      "tags": ["benchmark", "realtime"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "contracts": { "produces": ["metrics_report_json"] },
      "inputs": [
        { "name": "config", "kind": "file", "required": false, "flag": "--config" },
        { "name": "output", "kind": "file", "required": false, "flag": "--output", "default": "reports/benchmark_latency.json" }
      ],
      "outputs": [
        { "name": "report_json", "kind": "file", "default": "reports/benchmark_latency.json" },
        { "name": "history_jsonl", "kind": "file", "description": "Optional JSONL history when --history is set." }
      ],
      "examples": [
        {
          "description": "Synthetic benchmark (no inference) to validate harness.",
          "command": "python3 tools/benchmark_latency.py --iterations 200 --warmup 20 --output reports/benchmark_latency.json --history reports/benchmark_latency.jsonl --notes \"baseline on target HW\""
        }
      ],
      "docs": ["docs/benchmark_latency.md"]
    },
    {
      "id": "run_scenarios",
      "entrypoint": "tools/run_scenarios.py",
      "runner": "python3",
      "summary": "Run the scenario suite pipeline (adapter + constraints utilities) and write a report JSON.",
      "tags": ["scenarios", "pipeline"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "examples": [
        { "description": "Run a basic dummy scenario pass.", "command": "python3 tools/run_scenarios.py --adapter dummy --dataset data/coco128 --max-images 50" }
      ]
    },
    {
      "id": "check_license_policy",
      "entrypoint": "tools/check_license_policy.py",
      "runner": "python3",
      "summary": "Enforce Apache-2.0-only constraints (denylist + no vendored GPL/AGPL license texts).",
      "tags": ["policy", "license"],
      "platform": { "cpu_ok": true, "gpu_required": false, "macos_ok": true, "linux_ok": true },
      "outputs": [{ "name": "stdout", "kind": "stdout", "description": "OK or failure reason." }],
      "examples": [{ "description": "Run policy checks.", "command": "python3 tools/check_license_policy.py" }],
      "docs": ["docs/license_policy.md"]
    }
  ]
}
