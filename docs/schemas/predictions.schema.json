{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "YOLOZU Predictions JSON",
  "description": "Predictions artifact consumed/produced by tools/*.py. Canonical form is {predictions:[...], meta:{...}}, but other legacy shapes are supported.",
  "oneOf": [
    { "$ref": "#/$defs/predictions_wrapper" },
    { "$ref": "#/$defs/predictions_list" },
    { "$ref": "#/$defs/predictions_mapping" }
  ],
  "$defs": {
    "bbox_cxcywh_norm": {
      "type": "object",
      "required": ["cx", "cy", "w", "h"],
      "properties": {
        "cx": { "type": "number" },
        "cy": { "type": "number" },
        "w": { "type": "number" },
        "h": { "type": "number" }
      },
      "additionalProperties": true
    },
    "detection": {
      "type": "object",
      "required": ["score", "bbox"],
      "properties": {
        "class_id": { "type": "integer" },
        "category_id": { "type": "integer" },
        "score": { "type": "number" },
        "bbox": { "$ref": "#/$defs/bbox_cxcywh_norm" },

        "log_z": { "type": "number" },
        "rot6d": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 6,
          "maxItems": 6
        },
        "offsets": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 2,
          "maxItems": 2
        },
        "k_delta": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 4,
          "maxItems": 4
        },

        "log_sigma_z": { "type": "number" },
        "log_sigma_rot": { "type": "number" },
        "sigma_z": { "type": "number" },
        "sigma_rot": { "type": "number" },

        "score_det": { "type": "number" },
        "score_tmp_sym": { "type": "number" }
      },
      "additionalProperties": true
    },
    "prediction_entry": {
      "type": "object",
      "required": ["image"],
      "properties": {
        "image": { "type": "string" },
        "detections": {
          "type": "array",
          "items": { "$ref": "#/$defs/detection" }
        }
      },
      "additionalProperties": true
    },
    "predictions_list": {
      "type": "array",
      "items": { "$ref": "#/$defs/prediction_entry" }
    },
    "predictions_wrapper": {
      "type": "object",
      "required": ["predictions"],
      "properties": {
        "predictions": { "$ref": "#/$defs/predictions_list" },
        "meta": { "type": "object", "additionalProperties": true }
      },
      "additionalProperties": true
    },
    "predictions_mapping": {
      "type": "object",
      "description": "Legacy mapping format: { \"image.jpg\": [detections...], ... }",
      "additionalProperties": {
        "type": "array",
        "items": { "$ref": "#/$defs/detection" }
      }
    }
  }
}

