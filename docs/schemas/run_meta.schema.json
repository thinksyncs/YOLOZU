{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "YOLOZU Run Meta Contract",
  "description": "Reproducibility metadata emitted at runs/<run_id>/reports/run_meta.json.",
  "type": "object",
  "required": [
    "schema_version",
    "git",
    "dependency_lock",
    "preprocess",
    "hardware",
    "runtime",
    "command"
  ],
  "properties": {
    "schema_version": { "type": "integer", "minimum": 1 },
    "git": {
      "type": "object",
      "required": ["sha"],
      "properties": {
        "sha": { "type": "string", "minLength": 1 },
        "dirty": { "type": ["boolean", "null"] }
      },
      "additionalProperties": true
    },
    "dependency_lock": {
      "type": "object",
      "required": ["python_version", "package_count", "package_set_sha256", "requirements_files_sha256"],
      "properties": {
        "python_version": { "type": "string" },
        "package_count": { "type": "integer", "minimum": 0 },
        "package_set_sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "requirements_files_sha256": {
          "type": "object",
          "additionalProperties": { "type": "string", "pattern": "^[a-f0-9]{64}$" }
        }
      },
      "additionalProperties": true
    },
    "preprocess": {
      "type": "object",
      "required": ["image_size"],
      "properties": {
        "image_size": { "type": "integer", "minimum": 1 },
        "multiscale": { "type": "boolean" },
        "scale_min": { "type": ["number", "null"] },
        "scale_max": { "type": ["number", "null"] }
      },
      "additionalProperties": true
    },
    "runtime": {
      "type": "object",
      "required": ["python_version", "platform", "python_executable"],
      "properties": {
        "python_version": { "type": "string" },
        "platform": { "type": "string" },
        "python_executable": { "type": "string" }
      },
      "additionalProperties": true
    },
    "hardware": {
      "type": "object",
      "required": ["host", "accelerator"],
      "properties": {
        "host": { "type": "object", "additionalProperties": true },
        "accelerator": { "type": "object", "additionalProperties": true }
      },
      "additionalProperties": true
    },
    "command": {
      "type": "object",
      "required": ["argv", "command_str", "python_executable", "cwd"],
      "properties": {
        "argv": { "type": "array", "items": { "type": "string" } },
        "command": { "type": "array", "items": { "type": "string" } },
        "command_str": { "type": "string" },
        "python_executable": { "type": "string" },
        "cwd": { "type": "string" }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
